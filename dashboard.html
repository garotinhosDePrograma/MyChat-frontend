<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0084ff">
    <link rel="icon" href="/assets/icons/favicon.ico" sizes="any">
    <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png">

    <title>Dashboard - MyChat</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <h2>üí¨ MyChat</h2>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <!-- Theme Toggle -->
                    <div id="theme-toggle-container"></div>
                    
                    <!-- User Menu -->
                    <div class="user-menu">
                        <button class="user-menu-btn" id="user-menu-btn" aria-label="Menu do usu√°rio">‚ãÆ</button>
                        <div class="user-menu-dropdown hidden" id="user-menu-dropdown">
                            <div class="user-info">
                                <strong id="user-name-display"></strong>
                                <p class="text-muted" id="user-email-display"></p>
                            </div>
                            <button id="settings-btn">‚öôÔ∏è Configura√ß√µes</button>
                            <button id="logout-btn" class="text-danger">üö™ Sair</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="search-bar">
                <button class="btn btn-primary btn-full" id="add-contact-btn">
                    ‚ûï Adicionar Contato
                </button>
            </div>
            
            <!-- Contacts List -->
            <div class="contacts-list" id="contacts-list">
                <div class="spinner"></div>
            </div>
        </aside>
        
        <!-- Chat Area -->
        <main class="chat-area" id="chat-area" style="display: none;">
            <div class="chat-background"></div>
            
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-header-info">
                    <button class="btn btn-ghost btn-icon" onclick="document.querySelector('.sidebar').classList.remove('hidden')" style="display: none;" id="back-btn" aria-label="Voltar">
                        ‚Üê
                    </button>
                    <div class="contact-avatar" id="chat-header-avatar">?</div>
                    <div>
                        <h3 class="chat-header-name" id="chat-header-name">Selecione um contato</h3>
                        <p class="chat-header-status text-muted" id="chat-header-status">Online</p>
                    </div>
                </div>
                <div>
                    <button class="btn btn-ghost btn-icon" aria-label="Buscar" title="Buscar mensagens">
                        üîç
                    </button>
                    <button class="btn btn-ghost btn-icon" aria-label="Mais op√ß√µes" title="Mais op√ß√µes">
                        ‚ãÆ
                    </button>
                </div>
            </div>
            
            <!-- Messages -->
            <div class="chat-messages" id="chat-messages">
                <!-- Messages will be rendered here -->
            </div>
            
            <!-- Typing Indicator (hidden by default) -->
            <div id="typing-indicator" class="hidden" style="padding: 0 20px 10px;">
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <!-- Input -->
            <div class="chat-input-container">
                <form class="chat-input-form" id="chat-form">
                    <div class="chat-input-wrapper">
                        <textarea 
                            class="chat-input" 
                            id="chat-input" 
                            placeholder="Digite uma mensagem..."
                            rows="1"
                            aria-label="Digite sua mensagem"
                        ></textarea>
                        <button type="button" class="emoji-btn" aria-label="Adicionar emoji" title="Em breve: Emojis">
                            üòä
                        </button>
                    </div>
                    <button type="submit" class="send-btn" id="send-btn" aria-label="Enviar mensagem">
                        ‚û§
                    </button>
                </form>
            </div>
        </main>
        
        <!-- Empty State (quando nenhum contato selecionado) -->
        <div class="chat-area flex-center" id="empty-state">
            <div class="empty-state">
                <div class="empty-state-icon">üí¨</div>
                <h3>Bem-vindo ao MyChat</h3>
                <p class="text-muted">Selecione um contato para come√ßar a conversar</p>
                <p class="text-muted" style="font-size: 12px; margin-top: 20px;">
                    üí° Dica: Use <kbd>Ctrl+K</kbd> para buscar contatos
                </p>
            </div>
        </div>
    </div>
    
    <!-- Modal: Adicionar Contato -->
    <div class="modal hidden" id="add-contact-modal" role="dialog" aria-labelledby="modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Adicionar Contato</h3>
                <button class="close-modal" id="close-modal" aria-label="Fechar modal">√ó</button>
            </div>
            
            <div class="input-group">
                <label for="search-input">Buscar por nome ou email</label>
                <input 
                    type="text" 
                    id="search-input" 
                    placeholder="Digite para buscar..."
                    autocomplete="off"
                    aria-label="Campo de busca"
                >
            </div>
            
            <div class="search-results" id="search-results">
                <!-- Search results will be rendered here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/sw-register.js"></script>
    
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="js/socket.js"></script>
    <script src="js/dashboard.js"></script>
    
    <script>
        // Mostrar informa√ß√µes do usu√°rio
        const user = Storage.getUser();
        if (user) {
            document.getElementById('user-name-display').textContent = user.name;
            document.getElementById('user-email-display').textContent = user.email;
        }
        
        // Adicionar toggle de tema ao container
        const themeContainer = document.getElementById('theme-toggle-container');
        if (themeContainer) {
            ThemeManager.addToggleTo(themeContainer);
        }
        
        // Mostrar bot√£o de voltar em mobile
        if (window.innerWidth <= 768) {
            document.getElementById('back-btn').style.display = 'flex';
        }
        
        // Atalho de teclado para buscar contatos (Ctrl+K)
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                document.getElementById('add-contact-btn')?.click();
            }
        });
    </script>
</body>
</html>
